

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Matlab &mdash; Aalto scientific computing</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="Aalto scientific computing" href="../../index.html"/>
        <link rel="up" title="Applications: General info" href="index.html"/>
        <link rel="next" title="MLPack" href="mlpack.html"/>
        <link rel="prev" title="Using Mathematica on Triton" href="mathematica.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Aalto scientific computing
          

          
            
            <img src="../../_static/aalto.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../aalto/welcomeresearchers.html">Welcome, researchers!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aalto/welcomestudents.html">Welcome, students!</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../news/index.html">News</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../aalto/index.html">The Aalto environment</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../data/index.html">Data</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Triton user guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#quick-contents-and-links">Quick contents and links</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#tutorials">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#detailed-instructions">Detailed instructions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#applications">Applications</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html">Applications: General info</a></li>
<li class="toctree-l3"><a class="reference internal" href="aims.html">FHI-aims</a></li>
<li class="toctree-l3"><a class="reference internal" href="armadillo.html">Armadillo</a></li>
<li class="toctree-l3"><a class="reference internal" href="boost.html">Boost</a></li>
<li class="toctree-l3"><a class="reference internal" href="cosmol.html">COMSOL Multiphysics</a></li>
<li class="toctree-l3"><a class="reference internal" href="deeplearn.html">Deep learning software</a></li>
<li class="toctree-l3"><a class="reference internal" href="detectron.html">Detectron</a></li>
<li class="toctree-l3"><a class="reference internal" href="fenics.html">Fenics</a></li>
<li class="toctree-l3"><a class="reference internal" href="fmriprep.html">FMRIprep</a></li>
<li class="toctree-l3"><a class="reference internal" href="freesurfer.html">Freesurfer</a></li>
<li class="toctree-l3"><a class="reference internal" href="fsl.html">FSL</a></li>
<li class="toctree-l3"><a class="reference internal" href="gpaw.html">GPAW</a></li>
<li class="toctree-l3"><a class="reference internal" href="julia.html">Julia language on triton</a></li>
<li class="toctree-l3"><a class="reference internal" href="jupyter.html">Jupyter</a></li>
<li class="toctree-l3"><a class="reference internal" href="keras.html">Keras</a></li>
<li class="toctree-l3"><a class="reference internal" href="lammps.html">Lammps</a></li>
<li class="toctree-l3"><a class="reference internal" href="mathematica.html">Using Mathematica on Triton</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Matlab</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#matlab-configuration">Matlab configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interactive-usage">Interactive usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#simple-serial-script">Simple serial script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multiple-serial-batchjobs">Multiple serial batchjobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parallel-matlab-with-matlab-s-internal-parallelization">Parallel Matlab with Matlab&#8217;s internal parallelization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parallel-natlab-with-parpool">Parallel Natlab with parpool</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parallel-matlab-in-exclusive-mode">Parallel matlab in exclusive mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hints-for-condor-users">Hints for Condor users</a></li>
<li class="toctree-l4"><a class="reference internal" href="#faq-troubleshooting">FAQ / troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mlpack.html">MLPack</a></li>
<li class="toctree-l3"><a class="reference internal" href="mne.html">MNE</a></li>
<li class="toctree-l3"><a class="reference internal" href="octave.html">Octave</a></li>
<li class="toctree-l3"><a class="reference internal" href="openfoam.html">OpenFOAM (with ParaView)</a></li>
<li class="toctree-l3"><a class="reference internal" href="openpose.html">OpenPose</a></li>
<li class="toctree-l3"><a class="reference internal" href="paraview.html">Paraview</a></li>
<li class="toctree-l3"><a class="reference internal" href="python.html">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="r.html">R</a></li>
<li class="toctree-l3"><a class="reference internal" href="rstan.html">RStan</a></li>
<li class="toctree-l3"><a class="reference internal" href="rstudio.html">RStudio</a></li>
<li class="toctree-l3"><a class="reference internal" href="siesta.html">Siesta &amp; Transiesta</a></li>
<li class="toctree-l3"><a class="reference internal" href="sjupyter.html">Your own notebooks via <code class="docutils literal"><span class="pre">sjupyter</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="spyder.html">Spyder</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensorflow.html">Tensorflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="theano.html">Theano</a></li>
<li class="toctree-l3"><a class="reference internal" href="vasp.html">VASP</a></li>
<li class="toctree-l3"><a class="reference internal" href="visit.html">VisIT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#reference-and-examples">Reference and Examples</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../scicomp/index.html">Scientific computing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../training/index.html">Training</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">About these docs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Aalto scientific computing</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Triton user guide</a> &raquo;</li>
      
          <li><a href="index.html">Applications: General info</a> &raquo;</li>
      
    <li>Matlab</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/AaltoScienceIT/scicomp-docs/blob/master/triton/apps/matlab.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="matlab">
<h1>Matlab<a class="headerlink" href="#matlab" title="Permalink to this headline">¶</a></h1>
<p>This page will guide you through the serial computing with Matlab at
Triton cluster.  (Note (2017): We used to have the Matlab Distributed
Computing Server (MDCS), but because of low use we no longer have a
license.  You can still run in parallel on one node, up to 20-28 cores
depending on how new.)</p>
<div class="section" id="matlab-configuration">
<h2>Matlab configuration<a class="headerlink" href="#matlab-configuration" title="Permalink to this headline">¶</a></h2>
<p>Matlab writes session data, compiled code and additional toolboxes to
<code class="docutils literal"><span class="pre">~/.matlab</span></code>. This can quicky fill up your <code class="docutils literal"><span class="pre">$HOME</span></code> quota. To fix this
we recommend that you replace the folder with a symlink that points to
a directory in your working directory.</p>
<div class="highlight-python"><div class="highlight"><pre>rsync -lrt ~/.matlab/ $WRKDIR/matlab-config/ &amp;&amp; rm -r ~/.matlab
ln -sT $WRKDIR/matlab-config ~/.matlab
quotafix -gs --fix $WRKDIR/matlab-config
</pre></div>
</div>
</div>
<div class="section" id="interactive-usage">
<h2>Interactive usage<a class="headerlink" href="#interactive-usage" title="Permalink to this headline">¶</a></h2>
<p>Interactive usage is currently available via the sinteractive tool. Do
not use the cluster front-end for doing heavy task. Only meant for
submitting jobs/compiling. Using MDCS for sending jobs is ok.</p>
<div class="highlight-python"><div class="highlight"><pre>ssh -X user@triton.aalto.fi
sinteractive
module load matlab
matlab &amp;
</pre></div>
</div>
</div>
<div class="section" id="simple-serial-script">
<h2>Simple serial script<a class="headerlink" href="#simple-serial-script" title="Permalink to this headline">¶</a></h2>
<p>Running a single core Matlab job is easy through the slurm queue. A
sample slurm script is provided underneath:</p>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/bash -l
#SBATCH -p short
#SBATCH -t 00:05:00
#SBATCH -n 1
#SBATCH --mem-per-cpu=100
#SBATCH -o serial_Matlab.out
module load matlab
n=3
m=2
srun matlab -nojvm -nosplash -r &quot;serial_Matlab($n,$m) ; exit(0)&quot;
</pre></div>
</div>
<p>The above script can then be saved as a file (e.g. matlab_test.slrm) and the job can be submitted with <code class="docutils literal"><span class="pre">sbatch</span> <span class="pre">matlab_test.slrm</span></code>. The actual calculation is done in <code class="docutils literal"><span class="pre">serial_Matlab.m</span></code>-file:</p>
<div class="highlight-python"><div class="highlight"><pre>function C = serial_Matlab(n,m)
        try
                A=0:(n*m-1);
                A=reshape(A,[2,3]).&#39;

                B=2:(n*m+1);
                B=reshape(B,[2,3]).&#39;

                C=0.5*ones(n,n)
                C=A*(B.&#39;) + 2.0*C
        catch error
                disp(getReport(error))
                exit(1)
        end
end
</pre></div>
</div>
<p>Remember to <em>always</em> set exit into your slurm script so that the program quits
once the function <code class="docutils literal"><span class="pre">serial_Matlab</span></code> has finished. Using a
try-catch-statement will allow your job to finish in case of any error
within the program.  If you don&#8217;t do this, Matlab will drop into
interactive mode and do nothing while your cluster time wastes.</p>
<p>NOTE: Starting from version r2019a the launch options  <code class="docutils literal"><span class="pre">-r</span> <span class="pre">...;</span> <span class="pre">exit(0)</span></code> can be easily
replaced with the <code class="docutils literal"><span class="pre">-batch</span></code> option which automatically exits matlab at the end of the command that is passed
(<a class="reference external" href="https://se.mathworks.com/help/matlab/ref/matlablinux.html">see here for details</a>).
So the last command from the slurm script above for Matlab r2019a will look like:</p>
<div class="highlight-python"><div class="highlight"><pre>srun matlab -nojvm -nosplash -batch &quot;serial_Matlab($n,$m);&quot;
</pre></div>
</div>
</div>
<div class="section" id="multiple-serial-batchjobs">
<h2>Multiple serial batchjobs<a class="headerlink" href="#multiple-serial-batchjobs" title="Permalink to this headline">¶</a></h2>
<p>The most common way to utilize Matlab is to write a single .M-file that
can be used to run tasks as a non-interactive batch job. These jobs are
then submitted as independent tasks and when the heavy part is done, the
results are collected for analysis. For these kinds of jobs the Slurm
array jobs is the best choice; For more information on array jobs see
Array jobs in the Triton user guide.</p>
<p>Below you will find an example how-to prepare and run such type of jobs.</p>
<p><strong>run.m file doing the actual calculation task</strong></p>
<p>The file below calculates Sin-function in the interval 0-2*PI and
stores the results into a file. The interval is divided into blocks that
are distributed over the nodes.</p>
<div class="highlight-python"><div class="highlight"><pre>function run(blockIndex,pointsPerBlock,totalBlocks)
% blockindex runs from 0..totalblocks-1
% range 0..2pi
length=2*pi;
% values to setup even spacing between given range
% and splitting the spacings to even number of points per block
totalPoints=pointsPerBlock*totalBlocks;
step=length/(totalPoints-1);
start=blockIndex*pointsPerBlock*step;
% do some calculations, store the resulst so arrays A and B
for index=0:pointsPerBlock-1
  i=index+1;
  x=start+index*step;
  y=sin(x);
  A(i)=x;
  B(i)=y;
end
% save the results based on the blockIndex to a file
filename=strcat(&#39;output-&#39;,int2str(blockIndex));
save( filename, &#39;A&#39;, &#39;B&#39;, &#39;blockIndex&#39;);
% display message to output (log) that we have reached this far.
disp(sprintf(&#39;SUCCESS blockIndex %d&#39;,blockIndex));
% exit as this is a batch-job
exit;
</pre></div>
</div>
<p><strong>Submission of 10 independent tasks</strong></p>
<p>Below the <strong>run.m</strong> is executed as an array job with 10 array tasks,
which will execute independently, potentially in parallel if there are
enough idle resources. Note that it is using play partition with 5min
time limit.</p>
<p>matslurm.sh:</p>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/bash -l
#SBATCH --time=0-00:05:00 --mem-per-cpu=500
#SBATCH -p debug
#SBATCH -o job-%a.out
#SBATCH --array=0-9
module load matlab
matlab -nojvm -r &quot;run($SLURM_ARRAY_TASK_ID,100,10); quit&quot;
</pre></div>
</div>
<p>Submit the job with &#8220;sbatch matslurm.sh&#8221; (or whatever you called the
batch job script above).</p>
<p><strong>Collecting the results</strong></p>
<p>Finally a wrapper script to read in the .mat files and plots you tha
Sin-function calculated in parallel with 10 tasks.:</p>
<div class="highlight-python"><div class="highlight"><pre>function collectResults(numberOfBlocks)
   X=[];
   Y=[];
   for index=0:numberOfBlocks-1
      % read the output from the jobs
      filename = strcat( &#39;output-&#39;, int2str( index ) );
      load( filename );
      % catenate results to a single arrays
      X=cat(2,X,A);
      Y=cat(2,Y,B);
   end
   plot(X,Y,&#39;b+:&#39;)
</pre></div>
</div>
<div class="section" id="seeding-the-random-number-generator">
<h3>Seeding the random number generator<a class="headerlink" href="#seeding-the-random-number-generator" title="Permalink to this headline">¶</a></h3>
<p>Note that by default MATLAB always initializes the random number
generator with a constant value. Thus if you launch several matlab
instances e.g. to calculate distinct ensembles, then you need to seed
the random number generator such that it&#8217;s distinct for each
instance. In order to do this, you can call the <code class="docutils literal"><span class="pre">rng()</span></code> function,
passing the value of <code class="docutils literal"><span class="pre">$SLURM_ARRAY_TASK_ID</span></code> to it.</p>
</div>
</div>
<div class="section" id="parallel-matlab-with-matlab-s-internal-parallelization">
<h2>Parallel Matlab with Matlab&#8217;s internal parallelization<a class="headerlink" href="#parallel-matlab-with-matlab-s-internal-parallelization" title="Permalink to this headline">¶</a></h2>
<p>Matlab has internal parallelization that can be activated by requesting
more than one cpu per task in the
<a class="reference download internal" href="../../_downloads/int_parallel.slrm" download=""><code class="xref download docutils literal"><span class="pre">Slurm</span> <span class="pre">script</span></code></a>
and using the <code class="docutils literal"><span class="pre">matlab_multithread</span></code> to start the interpreter.</p>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/bash -l
#SBATCH -p short
#SBATCH -t 00:15:00
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4
#SBATCH --mem-per-cpu=2G
#SBATCH -o int_parallel.out

module load matlab
srun time -p matlab_multithread -nojvm -nosplash -r &quot;int_parallel() ; exit(0)&quot;
</pre></div>
</div>
<p>An example function is provided in
<a class="reference download internal" href="../../_downloads/int_parallel.m" download=""><code class="xref download docutils literal"><span class="pre">this</span> <span class="pre">script</span></code></a></p>
<div class="highlight-matlab"><div class="highlight"><pre><span class="k">function</span><span class="w"> </span><span class="nf">int_parallel</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="k">try</span>
                <span class="n">tic</span><span class="p">;</span>
                <span class="n">A</span> <span class="p">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">2000</span><span class="p">);</span>
                <span class="n">A</span> <span class="p">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="o">&#39;</span><span class="p">;</span>
                <span class="n">B</span> <span class="p">=</span> <span class="n">pinv</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
                <span class="n">max</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">A</span><span class="p">))</span>
                <span class="n">toc</span>
        <span class="k">catch</span> <span class="n">error</span>
                <span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Error occured&#39;</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="parallel-natlab-with-parpool">
<h2>Parallel Natlab with parpool<a class="headerlink" href="#parallel-natlab-with-parpool" title="Permalink to this headline">¶</a></h2>
<p>Often one uses Matlab&#8217;s parallel pool for parallelization. When
using <code class="docutils literal"><span class="pre">parpool</span></code> one needs to specify the number of workers. This
number should match the number of CPUs requested. <code class="docutils literal"><span class="pre">parpool</span></code> uses
JVM so when launching the interpreter one needs to use <code class="docutils literal"><span class="pre">-nodisplay</span></code>
instead of <code class="docutils literal"><span class="pre">-nojvm</span></code>. Example
<a class="reference download internal" href="../../_downloads/parpool_parallel.slrm" download=""><code class="xref download docutils literal"><span class="pre">Slurm</span> <span class="pre">script</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/bash -l
#SBATCH -p short
#SBATCH -t 00:15:00
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4
#SBATCH --mem-per-cpu=2G
#SBATCH -o parpool_parallel.out

module load matlab

srun matlab_multithread -nodisplay -r &quot;parpool_parallel($SLURM_CPUS_PER_TASK) ; exit(0)&quot;
</pre></div>
</div>
<p>An example function is provided in
<a class="reference download internal" href="../../_downloads/parpool_parallel.m" download=""><code class="xref download docutils literal"><span class="pre">this</span> <span class="pre">script</span></code></a></p>
<div class="highlight-matlab"><div class="highlight"><pre><span class="k">function</span><span class="w"> </span><span class="nf">parpool_parallel</span><span class="p">(</span>n<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="c">% Try-catch expression that quits the Matlab session if your code crashes</span>
        <span class="k">try</span>
                <span class="c">% Initialize the parallel pool</span>
                <span class="n">c</span><span class="p">=</span><span class="n">parcluster</span><span class="p">();</span>
                <span class="n">t</span><span class="p">=</span><span class="n">tempname</span><span class="p">()</span>
                <span class="n">mkdir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">c</span><span class="p">.</span><span class="n">JobStorageLocation</span><span class="p">=</span><span class="n">t</span><span class="p">;</span>
                <span class="n">parpool</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
                <span class="c">% The actual program calls from matlab&#39;s example.</span>
                <span class="c">% The path for r2017b</span>
                <span class="n">addpath</span><span class="p">(</span><span class="n">strcat</span><span class="p">(</span><span class="n">matlabroot</span><span class="p">,</span> <span class="s">&#39;/examples/distcomp/main&#39;</span><span class="p">));</span>
                <span class="c">% The path for r2016b</span>
                <span class="c">% addpath(strcat(matlabroot, &#39;/examples/distcomp&#39;));</span>

                <span class="c">% simulate 10000 blackjack hands with 100 players</span>
                <span class="n">tic</span><span class="p">;</span>
                <span class="n">pctdemo_aux_parforbench</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
                <span class="n">toc</span>
        <span class="k">catch</span> <span class="n">error</span>
                <span class="n">getReport</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Error occured&#39;</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="parallel-matlab-in-exclusive-mode">
<h2>Parallel matlab in exclusive mode<a class="headerlink" href="#parallel-matlab-in-exclusive-mode" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/bash -l
#SBATCH -p short
#SBATCH -t 00:15:00
#SBATCH --exclusive
#SBATCH -o parallel_Matlab3.out

export OMP_NUM_THREADS=$(nproc)

module load matlab/r2017b
srun -n 1 -c $OMP_NUM_THREADS matlab_multithread -nosplash -r &quot;parallel_Matlab3($OMP_NUM_THREADS) ; exit(0)&quot;
</pre></div>
</div>
<p>parallel_Matlab3.m:</p>
<div class="highlight-python"><div class="highlight"><pre>function parallel_Matlab3(n)
        % Try-catch expression that quits the Matlab session if your code crashes
        try
                % Initialize the parallel pool
                c=parcluster();
                t=tempname()
                mkdir(t)
                c.JobStorageLocation=t;
                parpool(c,n);
                % The actual program calls from matlab&#39;s example.
                % The path for r2017b
                addpath(strcat(matlabroot, &#39;/examples/distcomp/main&#39;));
                % The path for r2016b
                % addpath(strcat(matlabroot, &#39;/examples/distcomp&#39;));
                pctdemo_aux_parforbench(10000,100,n);
        catch error
                getReport(error)
                disp(&#39;Error occured&#39;);
                exit(0)
        end
end
</pre></div>
</div>
</div>
<div class="section" id="hints-for-condor-users">
<h2>Hints for Condor users<a class="headerlink" href="#hints-for-condor-users" title="Permalink to this headline">¶</a></h2>
<p>The above example also works (even nicer way) for condor.</p>
<p><strong>A wrapper script to execute matlab on the department workstation.</strong></p>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/bash -l
# a wrapper to run Matlab with condor
block=$1
pointsPerBlock=10
totalBlocks=10
matlab -nojvm -r &quot;run($block,$pointsPerBlock,$totalBlocks)&quot;
</pre></div>
</div>
<p><strong>Condor submission script</strong></p>
<p>Condor actually contains ArrayJob functionality that makes the task
easier.</p>
<div class="highlight-python"><div class="highlight"><pre>## Condor submit description (script) file for my_program.exe.
## 1. Specify the [path and] name for the executable file...
Executable = run.sh
## 2. Specify Condor execution environment.
Universe = vanilla
notify   = Error
## 3. Specify remote execution machines running Linux (required)...
Requirements = ((OpSys == &quot;Linux&quot;) || (OpSysName == &quot;Ubuntu&quot;))
## 4. Define input files and arguments
#Input = stdin.txt.$(Process)
Arguments = $(Process)
## 5. Define output/error/log files
Output = log/stdout.$(Process).txt
Error  = log/stderr.$(Process).txt
Log    = log/log.$(Process).txt
## 6. Tell Condor which files need to be transferred and when.
Transfer_input_files = run.m
Transfer_output_files = output-$(Process).mat
Transfer_executable = true
Should_transfer_files = YES
When_to_transfer_output = ON_EXIT
## 7. Add 10 copies of the job to the queue
Queue 10
</pre></div>
</div>
</div>
<div class="section" id="faq-troubleshooting">
<h2>FAQ / troubleshooting<a class="headerlink" href="#faq-troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>If things randomly don&#8217;t work, you can try removing or moving either the
<code class="docutils literal"><span class="pre">~/.matlab</span></code> directory or <code class="docutils literal"><span class="pre">~/.matlab/Rxxxxy</span></code> directory to see if it&#8217;s
caused by configuration.</p>
<p>Random error messages about things not loading and/or something
(Matlab Live Editor maybe) doesn&#8217;t work: <code class="docutils literal"><span class="pre">ls</span> <span class="pre">*.m</span></code>, do you have any
unexpected files like <code class="docutils literal"><span class="pre">pathdef.m</span></code> in there?  Remove them.</p>
<p>Also, check your home quota.  Often <code class="docutils literal"><span class="pre">.matlab</span></code> gets large and fills up
your home directory.  Check the answer at the very top of the page,
under &#8220;Matlab Configuration&#8221;.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mlpack.html" class="btn btn-neutral float-right" title="MLPack" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mathematica.html" class="btn btn-neutral" title="Using Mathematica on Triton" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Aalto Science-IT.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/redirect-to-https.js"></script>
      <script type="text/javascript" src="https://users.aalto.fi/~darstr1/minipres-stable.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>